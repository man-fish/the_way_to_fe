### 一、背景

**承接部门重点场景建设，落地厂内开放式内容社交平台，构建组织氛围建设新阵地，为员工间工作与生活交流互动提供移动端服务能力。**

### 二、需求

 用户侧需求脑图：              管理侧需求脑图：

![用户侧需求脑图](http://wiki.baidu.com/download/thumbnails/1357312070/image2021-1-19_15-7-33.png?version=1&modificationDate=1611040053000&api=v2)       ![管理测需求脑图](assets/image2021-1-19_15-8-16.png)

#### 2.1 用户侧

2.1.1 **首页**动态列表，需要支持推荐、关注两种形式下的列表数据。

2.1.2 首页顶部推荐话题，需要包含推荐话题卡片、查看更多。

2.1.3 **动态**卡片，需要包含用户信息、动态内容、点赞信息、评论外县、同事支持基本操作。

2.1.4 动态发布，需支持图片、拍照、文本三种动态发布方式，且发帖未完成支持备份。同时需要接入舆情监控。

2.1.5 动态发布过程，支持用户自定义话题，且自定义话题可点击推荐相关。

2.1.6 动态详情页，支持快捷进去话题，显示动态基本信息，评论信息，点赞信息、蹲评论。

2.1.7 **评论**发布，支持文本、插入图片、@、表情。

2.1.8 动态详情页评论区，支持显示热门/置顶 + 最新评论，支持楼中楼，支持评论的基本操作。另外回复支持小卡片页

2.1.9 全局**搜索**功能，支持搜索用户、话题、动态，关键词高亮。同时可单独查看更多搜索结果。

2.1.10 **话题**列表页，支持查询全部、热门、关注话题。话题卡片需要显示话题基本信息，直接关注，话题下相关数据（关注量、动态量）。

2.1.11 话题搜索，搜索支持分页、显示话题名、话题动态数据。

2.1.12 话题详情页，展示话题基本信息、数据、支持关注、话题下动态支持热门、最新两种列表。

2.1.13 **个人中心**，需要用户信息展示，数据（粉丝+关注+获赞），用户信息编辑、我的动态列表、我关注的话题列表、我的动态收藏列表。

2.1.14 关注粉丝数据列表，我的关注列表（支持取消、关注）、粉丝列表（支持取消、回关）。

2.1.15 我的关注数据，我的动态列表、我关注的话题列表、我收藏的动态内容。

2.1.16 个人信息修改，支持修改头像、昵称、个性签名。

2.1.17 他人个人中心，查看他人基本信息、关注、成就数据、动态列表。可调起如流会话。

2.1.18 **消息**中心，支持粉丝消息聚合展示、系统消息聚合展示、蹲评论，以及互动消息汇合列表。未读消息提醒、消息状态切换。

#### 2.2 管理侧

2.2.1 用户管理，区分用户列表、管理员列表，黑名单列表。支持搜索，禁言/取消禁言、查看动态。

2.2.2 话题&类目管理，类目增删改查，话题增删改查。用户自定义话题升级官方话题。

2.2.3 动态管理，分为常规动态管理、涉敏动态管理。支持动态列表查询，沉帖操作，查看评论。

2.2.4 评论管理，全站评论列表，按条件检索。置顶、删除操作。

2.2.5 举报管理，举报列表查询，举报处理。

2.2.6 数据统计，流量统计、内容生产统计、内容消费统计、关注数据统计。

2.2.7 操作日志，对用户、动态、话题、举报、评论数据的操作行为日志记录，按时间倒序展示。

#### 2.3 舆情侧

2.3.1 舆情系统，需要支持不同的业务数据接入 ，提供标准化接入方式。

2.3.2 热词分析，

2.3.3 氛围分析，

2.3.4 case跟进，

2.3.5 基础设置，

#### 2.4 SO/算法交互侧

2.4.1 数据协同接入，输出动态、用户关系画像，点赞评互动数据等

2.4.2 推荐列表拉取，个性化，by 用户

2.4.3 推荐列表操作，置顶，中插，撤销等

2.4.4 如流应用入口，滚动动态

### 三、需求分析

#### 3.1 同事圈系统架构图

![img](assets/image2021-1-20_14-31-54.png)



#### 3.2 同事圈重点功能时序图   

1) 一个内容元素齐全的动态是怎样发布的？

![img](assets/image2021-1-20_13-21-36.png)

2）推荐数据列表时序图  

![img](assets/image2021-1-20_13-23-16.png)



3）推荐内容流程图

![img](assets/image2021-1-20_19-27-4.png)

#### 3.3 同事圈核心功能拆解图

![img](assets/image2021-1-20_11-56-10.png)

### 四、方案

#### 4.1 前期资源申请准备

[同学圈环境资源报备](http://wiki.baidu.com/pages/viewpage.action?pageId=1357528797)



#### 4.2 模块化设计

**系统模块化设计 :**

**整体采用前后端分离：视图层 + 服务层（业务处理、数据层）**

通过系统功能架构图，可以将同学圈微服务化出来：

```
前端服务：
client ：用户侧，门户接口，不含有过多的业务逻辑
admin（OPP：Operation platform）：管理/运营平台，接口层
```

服务端：

web：接口服务

```
core：核心模块，用于逻辑业务处理
api ：API服务
task：任务服务（用户处理定时任务、数据同步）
POM （Public opinion monitoring）：舆情监控, 这里也需要在讨论下
这里比较犹豫：content、comment是否要拆分出来？放在core是否可以呢？
```



**数据库模块化设计:**

用户&运营号

角色权限

类目&话题信息

动态信息

用户动态行为数据

评论信息

蹲评论记录

好友关系

消息信息

举报信息

数据统计（时间线）

操作日志

系统配置类

简单币

### 五、方案详设

#### 5.0 帐号体系设计

##### **帐号体系**

1. 不论用户帐号、官方帐号、视频号……，本质其实还是帐号，只是类型、角色、可操作权限不同。
2. 非个人帐号需要挂靠在一个/多个用户帐号下

**![img](http://wiki.baidu.com/download/attachments/1357312070/image2021-1-28_16-34-54.png?version=1&modificationDate=1611822895000&api=v2)**

##### **帐号切换**

1. 非个人帐号需要使用系统，则需要由非官方帐号的主体（用户帐号）切换后，才能进行使用。
2. 切换后对于系统来说，当前登录帐号主体还是用户个人。

**![img](assets/image2021-1-28_16-35-20.png)**

##### **切换前后互动行为是怎么的**

这里便于操作，希望所有的行为绑定事件的直接发起帐号：

1. 个人帐号操作，绑定个人
2. 服务号操作，绑定服务号（同时增加服务号父级用户帐号）

**![img](assets/image2021-1-28_16-36-19.png)
**

#### 5.1 核心功能设计

##### **权限系统设计**

 （1）角色设计：目前包含：普通用户、管理员、运营号（服务号）

 （2）服务号 : 

​    ** 当作一个特殊的用户账号，拥有普通帐号的所有功能权限，同时拥有运营号相关权限 **

   目前如流不支持专用账号，所以服务号采用我们自己创建虚拟账号的方式，该账号与普通用户形式一样，不同点在这类账号需要挂靠到一个/多个拥有{运营号}角色的用户上。用户登录后可根据挂靠关系可以切换到服务号，进行发动态等操作。

   服务号发出的动态绑定到服务号身上。

 （3）类关系图

   

![img](assets/image2021-1-21_16-53-47.png)   

##### 个人用户帐号如何切换到服务号：

![img](assets/image2021-1-26_15-48-52.png)

#####  **动态内容关系设计**

   （1） 动态内容不支持富文本，纯文本形式存储，自定义话题格式需要跟前端约定好。

   （2）动态对图片、视频的展示要求比较高，需要缩略图、不同比例下走不同的展示模板。所以这里跟family不同了，动态的视频，图片资源上传时需要记录尺寸、比例、缩略图、视频时间等信息（这里可以加一个大字段用来存储扩展信息，已JSON的形式存储下来）

   （3）外链这里也需要特别对待，apache有个HtmlUnit他拥有无头浏览器的作用，可以抓取网页信息，提取图片、标题、概述等DOM节点信息。。有个问题，需要登录认证类型的网页专区卡片信息目前可能还有点困难(需要模拟登录后再抓取)。

##### 用户话题关注关系设计

![img](assets/image2021-1-21_21-23-5.png)

##### 用户好友关系设计

好友关注后，将拥有可以被@、关注列表查看好友动态、优先推荐的差异。

```
好友关系这里是双向的，已 user + friend的形式记录关系：
（1）wangqi49 关注了 wangwei111， 会生成 wangqi49(用户) + wangwei111(好友) + status（关注状态）；
（2）如果wangwei111 同样回关了 wangqi49，会在生成一条记录 wangwei111(用户) + wangqi49(好友) + status（关注状态）关系记录；
```

![img](assets/image2021-1-21_21-53-38.png)

##### 首页关注（关注动态）列表

[同学圈关注列表时间线设计方案](http://wiki.baidu.com/pages/viewpage.action?pageId=1380902923)



##### 消息服务设计

消息分为：蹲评论新评论消息通知、粉丝关注通知、系统消息、普通互动消息。

| 消息模型   | 消息类型                                                   | 发布                         | 订阅                                               | 订阅事件       | 订阅者                         | 订阅对象       | 订阅关系                 | 模版                                  | sender | senderName | receiver | receiverName | action                       | 示例                                 |
| :--------- | :--------------------------------------------------------- | :--------------------------- | :------------------------------------------------- | :------------- | :----------------------------- | :------------- | :----------------------- | :------------------------------------ | :----- | :--------- | :------- | :----------- | :--------------------------- | :----------------------------------- |
| 提醒       | 系统消息                                                   | System发布                   | 默认所有人订阅                                     | 系统提醒       | 所有人                         | 所有系统提醒   | 被动订阅                 | 恭喜你，通过有奖话题获得{} 个简单币。 | System | 系统       | wangwu   | 王五         | 获得简单币                   | 恭喜你，通过有奖话题获得5 个简单币。 |
| 蹲评论消息 | System发布                                                 | 选择性的，需要蹲操作         | 蹲评论                                             | 进行蹲操作的人 | 所蹲动态的评论                 | 主动蹲         | 单独维护                 |                                       |        |            |          |              |                              |                                      |
| 关注消息   | 粉丝                                                       | 被关注的人                   | 关注                                               | 被关注人       | 粉丝                           | 被关注         | {}关注了你               | zhangsan                              | 张三   | wangwu     | 王五     | 关注         | 张三关注了你                 |                                      |
| 互动消息   | 互动人                                                     | 默认订阅我的发布内容相关消息 | 文章点赞评论点赞文章评论评论恢复动态内被@评论中被@ | 所有人         | 我的文章的互动、我的评论的互动 | 发布内容被消费 | {}点赞了你的文章《%s》…… | zhangsan                              | 张三   | wangwu     | 王五     | 文章点赞     | 张三点赞了你的文章《干饭人》 |                                      |
| 公告       | 不存在公告类型的消息。公告类消息即消息发布后，需要全员消费 |                              |                                                    |                |                                |                |                          |                                       |        |            |          |              |                              |                                      |
| 私信       | 不存在私信类型的消息。点对点私信，也不支持                 |                              |                                                    |                |                                |                |                          |                                       |        |            |          |              |                              |                                      |



#####  评论设计

   这里直接复用hugo-comment

#### 5.2 管理后台功能设计

   （1） 操作日志管理： 日志内容，操作类型，操作时间,日志相关ID(例如动态Id,话题Id)

主要字段：操作类型，操作时间

操作日志内容模板：("AAA")沉底了动态("XXX")；枚举模板定制化信息

   （2） 数据统计:

@同学数：动态内容中有@同学的动态数(与@的同学数量无关)

   （3） 举报管理:

1.举报信息列表
2.操作：有效举报(为有效时删除该动态)、无效举报

   （4） 用户管理:

#### 5.3 性能问题设计考虑

- 动态详情缓存
- 话题列表缓存及刷新
- 好友关系缓存及刷新
- 评论走缓存
- 用户首屏消息缓存
- 点赞、收藏数据及详情缓存

#### 5.4 数据表设计

**用户&运营号**

- 用户基本信息表: colleague_user
  用户信息表复用portal_user表。同学圈这边增加一个用户扩展信息表。

  | `字段名`      | `字段类型(长度)` | `非空` | 索引 | `默认值`       | `说明`             |
  | :------------ | :--------------- | :----- | :--- | :------------- | :----------------- |
  | `id`          | `int(11)`        | `Y`    | Y    |                | `自增id`           |
  | `nick_name`   | `char(20)`       | `Y`    | Y    |                | `用户昵称`         |
  | `user_name`   | `char(50)`       | `Y`    | Y    |                | `用户名(用户账号)` |
  | business_name | `char(20)`       | Y      | Y    |                | 业务方名称         |
  | `photo`       | `char(200)`      | `Y`    |      |                | `头像`             |
  | signature     | varchar(100)     |        |      |                | 个性签名           |
  | account_type  | `char(20)`       | Y      | Y    |                | 账号类别           |
  | `create_user` | `char(50)`       | ``     |      |                | `创建人，授予人`   |
  | `create_date` | `datetime`       | `Y`    |      | `默认系统时间` | `创建时间`         |
  | `update_user` | `char(50)`       |        |      |                | 更新人             |
  | `update_date` | `datetime`       | `Y`    |      | `默认系统时间` | `更新时间`         |
  | `version`     | `int`            | `Y`    |      |                | `版本`             |

- 用户默认昵称库: colleague_default_nick_name

  | `字段名`      | `字段类型(长度)` | `非空` | 索引 | `默认值`       | `说明`                                   |
  | :------------ | :--------------- | :----- | :--- | :------------- | :--------------------------------------- |
  | `id`          | `int(11)`        | `Y`    | Y    |                | `自增id`                                 |
  | `nick_name`   | `char(20)`       | `Y`    | Y    |                | `默认昵称`                               |
  | `status`      | `char(50)`       | `Y`    | Y    | 0              | `被占用状态，0未被占用，1已被占哟哦那个` |
  | `create_date` | `datetime`       | `Y`    |      | `默认系统时间` | `创建时间`                               |
  | `update_date` | `datetime`       | `Y`    |      | `默认系统时间` | `更新时间`                               |
  | `version`     | `int`            | `Y`    |      |                | `版本`                                   |

- 用户运营号绑定关系表:  colleague_public_user_relation

  | `字段名`        | `字段类型(长度)` | `非空` | 索引 | `默认值`       | `说明`           |
  | :-------------- | :--------------- | :----- | :--- | :------------- | :--------------- |
  | `id`            | `int(11)`        | `Y`    | Y    |                | `自增id`         |
  | `user_name`     | `char(50)`       | `Y`    | Y    |                | `用户uuap name`  |
  | `operator_name` | `char(50)`       | `Y`    |      |                | `运营号 name`    |
  | `status`        | `char(20)`       | `Y`    | Y    | ``             | `状态`           |
  | `create_user`   | `char(50)`       | `Y`    |      |                | `创建人，授予人` |
  | `create_date`   | `datetime`       | `Y`    |      | `默认系统时间` | `创建时间`       |
  | `update_user`   | `char(50)`       | `Y`    |      |                | `更新人`         |
  | `update_date`   | `datetime`       | `Y`    |      | `默认系统时间` | `更新时间`       |
  | `version`       | `int`            | `Y`    |      |                | `版本`           |

**角色权限
**

- 角色表:colleague_role

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`           |
  | :------------ | :--------------- | :----- | :------------- | :--------------- |
  | `id`          | `int(11)`        | `Y`    |                | `自增id`         |
  | `name`        | `varchar(100)`   | `Y`    |                | `角色名称`       |
  | `code`        | `varchar(100)`   | `Y`    |                | `角色Code`       |
  | sort          | int(11)          |        |                | 排序             |
  | `create_user` | `char(50)`       | ``     |                | `创建人，授予人` |
  | `create_date` | `datetime`       | `Y`    | `默认系统时间` | `创建时间`       |
  | `update_user` | `char(50)`       | ``     |                | `更新人`         |
  | `update_date` | `datetime`       | `Y`    | `默认系统时间` | `更新时间`       |
  | `version`     | `int`            | `Y`    |                | `版本`           |

- 功能表:colleague_function

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`           |
  | :------------ | :--------------- | :----- | :------------- | :--------------- |
  | `id`          | `int(11)`        | `Y`    |                | `自增id`         |
  | `name`        | `varchar(100)`   | `Y`    |                | `功能名称`       |
  | `code`        | `varchar(100)`   | `Y`    |                | `功能Code`       |
  | `create_user` | `char(50)`       | ``     |                | `创建人，授予人` |
  | `create_date` | `datetime`       | `Y`    | `默认系统时间` | `创建时间`       |
  | `update_user` | `char(50)`       | ``     |                | `更新人`         |
  | `update_date` | `datetime`       | `Y`    | `默认系统时间` | `更新时间`       |
  | `version`     | `int`            | `Y`    |                | `版本`           |

- 导航表:colleague_menu

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`           |
  | :------------ | :--------------- | :----- | :------------- | :--------------- |
  | `id`          | `int(11)`        | `Y`    |                | `自增id`         |
  | `name`        | `varchar(100)`   | `Y`    |                | `导航名称`       |
  | `FUNCTION_ID` | `bigint(20)`     | ``     |                | `功能id`         |
  | PARENT_ID     | bigint(20)       | ``     |                | 上级ID           |
  | TARGET        | varchar(100)     | ``     |                | 打开方式         |
  | SORT          | int(11)          | ``     |                | 排序             |
  | REMARK        | varchar(255)     | `Y`    |                | 备注             |
  | path          | varchar(200)     | `Y`    |                | 导航路由         |
  | open          | tinyint(1)       | `Y`    | 1              | 是否开启         |
  | `create_user` | `char(50)`       | ``     |                | `创建人，授予人` |
  | `create_date` | `datetime`       | `Y`    | `默认系统时间` | `创建时间`       |
  | `update_user` | `char(50)`       | ``     |                | `更新人`         |
  | `update_date` | `datetime`       | `Y`    | `默认系统时间` | `更新时间`       |
  | `version`     | `int`            | `Y`    |                | `版本`           |

- 功能导航关联表:colleague_menu_function

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`           |
  | :------------ | :--------------- | :----- | :------------- | :--------------- |
  | `ID`          | `int(11)`        | `Y`    |                | `自增id`         |
  | `MENU_ID`     | `int(11)`        | `Y`    |                | `导航Id`         |
  | `FUNCTION_ID` | `bigint(20)`     | `Y`    |                | `功能id`         |
  | `create_user` | `char(50)`       | ``     |                | `创建人，授予人` |
  | `create_date` | `datetime`       | `Y`    | `默认系统时间` | `创建时间`       |
  | `update_user` | `char(50)`       | ``     |                | `更新人`         |
  | `update_date` | `datetime`       | `Y`    | `默认系统时间` | `更新时间`       |
  | `version`     | `int`            | `Y`    |                | `版本`           |

- 角色功能关联表:colleague_role_function

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`           |
  | :------------ | :--------------- | :----- | :------------- | :--------------- |
  | `id`          | `int(11)`        | `Y`    |                | `自增id`         |
  | `role_id`     | `varchar(100)`   | `Y`    |                | `角色id`         |
  | `function_id` | `varchar(100)`   | `Y`    |                | `功能Code`       |
  | `create_user` | `char(50)`       | ``     |                | `创建人，授予人` |
  | `create_date` | `datetime`       | `Y`    | `默认系统时间` | `创建时间`       |
  | `update_user` | `char(50)`       | ``     |                | `更新人`         |
  | `update_date` | `datetime`       | `Y`    | `默认系统时间` | `更新时间`       |
  | `version`     | `int`            | `Y`    |                | `版本`           |

- 用户角色信息表:colleague_user_role

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`           |
  | :------------ | :--------------- | :----- | :------------- | :--------------- |
  | `id`          | `int(11)`        | `Y`    |                | `自增id`         |
  | `user_name`   | `varchar(100)`   | `Y`    |                | `用户名称`       |
  | `role_id`     | `bigint(20)`     | `Y`    |                | `角色Id`         |
  | `create_user` | `char(50)`       | ``     |                | `创建人，授予人` |
  | `create_date` | `datetime`       | `Y`    | `默认系统时间` | `创建时间`       |
  | `update_user` | `char(50)`       | ``     |                | `更新人`         |
  | `update_date` | `datetime`       | `Y`    | `默认系统时间` | `更新时间`       |
  | `version`     | `int`            | `Y`    |                | `版本`           |

- 黑名单、禁言..用户表 : colleague_user_list (这里放一张表感觉比较合适，黑名单、禁言可以通过类型区分，结构相似。) 

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`                                                       |
  | :------------ | :--------------- | :----- | :------------- | :----------------------------------------------------------- |
  | `id`          | `int(11)`        | `Y`    |                | `自增id`                                                     |
  | `user_name`   | `char(50)`       | `Y`    |                | `用户uuap name`                                              |
  | `action`      | `char(50)`       | `Y`    |                | `事件类型：`BLACK_LIST 黑名单、WHITE_LIST 白名单、FORBIDDEN 禁言 |
  | `status`      | `char(20)`       | `Y`    | ``             | `状态：VALID有效，INVALID无效`                               |
  | reason        | varchar(200)     | `Y`    |                | 禁言理由                                                     |
  | `create_user` | `char(50)`       | `Y`    |                | `创建人`                                                     |
  | `create_date` | `datetime`       | `Y`    | `默认系统时间` | `创建时间`                                                   |
  | `update_user` | `char(50)`       | `Y`    |                | `更新人`                                                     |
  | `update_date` | `datetime`       | `Y`    | `默认系统时间` | `更新时间`                                                   |
  | `version`     | `int`            | `Y`    |                | `版本`                                                       |

**类目&话题信息**

- 类目基本信息表: colleague_category
- 话题基本信息表: colleague_topic
- 用户自定义话题表: colleague_custom_topic（建议单独拎出来）
- 用户加入话题关系表: colleague_user_topic
- 用户感兴趣类目信息表: colleague_user_category**
  **

**动态信息**

- 动态主体信息表: tongxue_moment

  | `字段名`        | `字段类型(长度)` | `非空` | `默认值`       | `说明`                 |
  | :-------------- | :--------------- | :----- | :------------- | :--------------------- |
  | `id`            | `bigint`         | `Y`    |                | `自增id`               |
  | `moment_id`     | `bigint`         | `Y`    |                | `动态业务ID`           |
  | `content`       | `varchar(500)`   | `N`    |                | `正文`                 |
  | `topic_id`      | `bigint`         | `N`    |                | `挂靠话题Id`           |
  | `author`        | `char(50)`       | `Y`    |                | `作者`                 |
  | `status`        | `char(20)`       | `Y`    |                | `状态：同学圈状态梳理` |
  | `contain_at`    | `tinyInt(1)`     | `Y`    | `0`            | `是否包含@`            |
  | `contain_image` | `tinyInt(1)`     | `Y`    | `0`            | `是否包含图片资源`     |
  | `contain_video` | `tinyInt(1)`     | `Y`    | `0`            | `是否包含视频资源`     |
  | `contain_link`  | `tinyInt(1)`     | `Y`    | `0`            | `是否包含外链资源`     |
  | `is_top`        | `tinyInt(1)`     | `Y`    | `0`            | `是否置顶`             |
  | `is_report`     | `tinyInt(1)`     | `Y`    | `0`            | `是否被成功举报`       |
  | `is_sink`       | `tinyInt(1)`     | `Y`    | `0`            | `是否被下沉`           |
  | `is_special`    | `tinyInt(1)`     | `Y`    | `0`            | `是否官方动态`         |
  | `pub_date`      | `datetime`       | `N`    |                | `发布时间`             |
  | `create_user`   | `char(50)`       | `Y`    |                | `创建人`               |
  | `create_date`   | `datetime`       | `Y`    | `默认系统时间` | `创建时间`             |
  | `update_user`   | `char(50)`       | `Y`    |                | `更新人`               |
  | `update_date`   | `datetime`       | `Y`    | `默认系统时间` | `更新时间`             |
  | `version`       | `int`            | `Y`    |                | `版本`                 |

- 动态图片视频资源信息表: colleague_content_resource

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`                                                       |
  | :------------ | :--------------- | :----- | :------------- | :----------------------------------------------------------- |
  | `id`          | `bigint`         | `Y`    |                | `自增id`                                                     |
  | `content_id`  | `bigint`         | `Y`    |                | `动态ID`                                                     |
  | `name`        | `char(100)`      | `Y`    |                | `名称`                                                       |
  | `type`        | `char(20)`       | `Y`    |                | `IMAGE、VIDEO、FILE`                                         |
  | `format`      | `char(20)`       |        |                | `.mp4、png、doc……`                                           |
  | `url`         | `varchar(200)`   | `Y`    |                | `资源链接`                                                   |
  | `size`        | `varchar(1000)`  | `N`    | `NULL`         | `资源大小`                                                   |
  | `sort`        | `int(11)`        | `Y`    | `1`            | `排序`                                                       |
  | `extra_info`  | `varchar(2000)`  | `N `   |                | `JSON格式，大字段，用于扩展字段。 如： 图片需要：尺寸、缩略图、比例 视频需要：播放时长 等信息` |
  | `create_user` | `char(50)`       | `Y`    |                | `创建人`                                                     |
  | `create_date` | `datetime`       | `Y`    | `默认系统时间` | `创建时间`                                                   |
  | `update_user` | `char(50)`       | `Y`    |                | `更新人`                                                     |
  | `update_date` | `datetime`       | `Y`    | `默认系统时间` | `更新时间`                                                   |
  | `version`     | `int`            | `Y`    |                | `版本`                                                       |

  

  

- 动态外链信息表

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`         |
  | :------------ | :--------------- | :----- | :------------- | :------------- |
  | `id`          | `bigint`         | `Y`    |                | `自增id`       |
  | `content_id`  | `bigint`         | `Y`    |                | `动态id`       |
  | `title`       | `char(100)`      | `Y`    |                | `标题`         |
  | `icon`        | `varchar(1000)`  | `N`    | `NULL`         | `icon`         |
  | `image`       | `varchar(1000)`  | `N`    | `NULL`         | `首图`         |
  | `summary`     | `varchar(200)`   | `N`    | `NULL`         | `概述`         |
  | `link`        | `varchar(1000)`  | `Y`    |                | `分享网址链接` |
  | `create_user` | `char(50)`       | `Y`    |                | `创建人`       |
  | `create_date` | `datetime`       | `Y`    | `默认系统时间` | `创建时间`     |
  | `update_user` | `char(50)`       | `Y`    |                | `更新人`       |
  | `update_date` | `datetime`       | `Y`    | `默认系统时间` | `更新时间`     |
  | `version`     | `int`            | `Y`    |                | `版本`         |

- 动态删除原因记录表

  | `字段名`        | `字段类型(长度)` | `非空` | `默认值`       | `说明`     |
  | :-------------- | :--------------- | :----- | :------------- | :--------- |
  | `id`            | `bigint`         | `Y`    |                | `自增id`   |
  | `content_id`    | `bigint`         | `Y`    |                | `动态id`   |
  | `delete_user`   | `char(50)`       | `Y`    |                | `操作人`   |
  | `delete_reason` | `varchar(200)`   | `N`    | `NULL`         | `删除原因` |
  | `delete_date`   | `datetime`       | `Y`    | `默认系统时间` | `删除时间` |
  | `version`       | `int`            | `Y`    |                | `版本`     |

- 敏感动态记录表

- 动态举报记录表

**用户动态行为数据**

- 用户对动态浏览记录表
- 用户对动态点赞表
- 用户对动态收藏表

**评论信息**

- 评论主体信息表
- 评论图片资源表
- 评论点赞表

**好友关系**

- 用户好友关注信息表

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`                 |
  | :------------ | :--------------- | :----- | :------------- | :--------------------- |
  | `id`          | `bigint`         | `Y`    |                | `自增id`               |
  | `user_name`   | `char(50)`       | `Y`    |                | `用户名`               |
  | `friend_name` | `char(50)`       | `Y`    |                | `好友名，关注对象名称` |
  | `status`      | `boolean`        | `Y`    | `1`            | `关注状态`             |
  | `CREATE_DATE` | `datetime`       | `N`    | `默认系统时间` | `创建/关注时间`        |
  | `UPDATE_DATE` | `datetime`       | `N`    | `默认系统时间` | `更新时间`             |
  | `version`     | `int`            | `Y`    |                | `版本`                 |

**消息信息**

- 用户消息表

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`         |
  | :------------ | :--------------- | :----- | :------------- | :------------- |
  | `id`          | `bigint`         | `Y`    |                | `自增id`       |
  | `sender`      | `char(50)`       | `Y`    |                | `发送人`       |
  | `receiver`    | `char(50)`       | `Y`    |                | `接受人`       |
  | `type`        | `char(50)`       | `Y`    |                | `消息类型`     |
  | `title`       | `char(200)`      | `Y`    |                | `消息标题`     |
  | `content`     | `varchar(2000)`  | `N`    |                | `消息内容`     |
  | `status`      | `boolean`        | `Y`    | `1`            | `消息读取状态` |
  | `create_user` | `char(50)`       | `Y`    |                | `创建人`       |
  | `create_date` | `datetime`       | `Y`    | `默认系统时间` | `创建时间`     |
  | `update_user` | `char(50)`       | `Y`    |                | `更新人`       |
  | `update_date` | `datetime`       | `Y`    | `默认系统时间` | `更新时间`     |
  | `version`     | `int`            | `Y`    |                | `版本`         |

- 蹲评论与消息信息表

  | `字段名`         | `字段类型(长度)` | `非空` | `默认值`       | `说明`         |
  | :--------------- | :--------------- | :----- | :------------- | :------------- |
  | `id`             | `bigint`         | `Y`    |                | `自增id`       |
  | `user_name`      | `char(50)`       | `Y`    |                | `用户名`       |
  | `content_id`     | `int(11)`        | `Y`    |                | `所蹲动态ID`   |
  | `status`         | `boolean`        | `Y`    | `1`            | `蹲状态`       |
  | `squat_date`     | `datetime`       | `N`    | `默认系统时间` | `蹲时间`       |
  | `msg_count`      | `int(11)`        | `N`    | `0`            | `新消息数量`   |
  | `last_read_date` | `datetime`       | `N`    |                | `最近一次阅读` |
  | `create_user`    | `char(50)`       | `Y`    |                | `创建人`       |
  | `create_date`    | `datetime`       | `Y`    | `默认系统时间` | `创建时间`     |
  | `update_user`    | `char(50)`       | `Y`    |                | `更新人`       |
  | `update_date`    | `datetime`       | `Y`    | `默认系统时间` | `更新时间`     |
  | `version`        | `int`            | `Y`    |                | `版本`         |

**操作日志**

- 管理员操作行为记录表

  | `字段名`          | `字段类型(长度)` | `非空` | `默认值`       | `说明`         |
  | :---------------- | :--------------- | :----- | :------------- | :------------- |
  | `id`              | `bigint`         | `Y`    |                | `自增id`       |
  | `operate_content` | `varchar(200)`   | ``     |                | `操作日志内容` |
  | `operate_type`    | varchar(128)     | `Y`    |                | 操作类型       |
  | `create_user`     | `char(50)`       | `Y`    |                | `创建人`       |
  | `create_date`     | `datetime`       | `Y`    | `默认系统时间` | `创建时间`     |
  | `update_user`     | `char(50)`       | ``     |                | `更新人`       |
  | `update_date`     | `datetime`       | `Y`    | `默认系统时间` | `更新时间`     |
  | `version`         | `int`            | `Y`    |                | `版本`         |

**系统配置类**

- 字典配置表

  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`     |
  | :------------ | :--------------- | :----- | :------------- | :--------- |
  | `字段名`      | `字段类型(长度)` | `非空` | `默认值`       | `说明`     |
  | `id`          | `bigint`         | `Y`    |                | `自增id`   |
  | `name`        | `varchar(100)`   | `Y`    |                | `名称`     |
  | `value`       | varchar(8200)    | `Y`    |                | 值         |
  | code          | varchar(100)     | `Y`    |                | 类型       |
  | sort          | int(11)          | `Y`    |                | 排序       |
  | remark        | varchar(200)     | `Y`    |                | 备注       |
  | `create_user` | `char(50)`       | `Y`    |                | `创建人`   |
  | `create_date` | `datetime`       | `Y`    | `默认系统时间` | `创建时间` |
  | `update_user` | `char(50)`       | `Y`    |                | `更新人`   |
  | `update_date` | `datetime`       | `Y`    | `默认系统时间` | `更新时间` |
  | `version`     | `int`            | `Y`    |                | `版本`     |

**简单币**

- 用户动态打赏记录表
- 有赏话题设置表
- 用户抽取简单币记录



数据脚本统一维护地址：[SQL变更统一报备](http://wiki.baidu.com/pages/viewpage.action?pageId=1358812069)