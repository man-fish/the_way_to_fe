## 内存指标

一般而言，应用中存在一些全局性的对象是正常的，而且在正常的使用中，变量都会自动释放回收。但是也会存在一些我们认为会回收但是却没有被回收的对象，这会导致内存占用无限增长。一旦增长达到 `V8` 的内存限制，将会得到内存溢出错误，进而导致进程退出。

###  查看内存使用情况

前面我们提到了 `process.memoryUsage()` 可以查看内存使用情况。除此之外，os模块中的 `totalmem()`和 `freemem()` 方法也可以查看内存使用情况。

**查看进程的内存占用**

调用 `process.memoryUsage()` 可以看到 `Node` 进程的内存占用情况，示例代码如下：

```ts
> process.memoryUsage()
{
  rss: 27639808,
  heapTotal: 9187328,
  heapUsed: 4557312,
  external: 1556302,
  arrayBuffers: 9403
}
```

`rss`是`resident set size`的缩写，即进程的常驻内存部分。进程的内存总共有几部分，一部分是`rss`，其余部分在交换区(`swap`)或者文件系统(`filesystem`)中。

除了`rss`外`，heapTotal`和`heapUsed`对应的是`V8`的堆内存信息。`heapTotal`是堆中总共申请的内存量，`heapUsed`表示目前堆中使用中的内存量。这`3`个值的单位都是字节。

**查看系统的内存占用**

与`process.memoryUsage()`不同的是，`os`模块中的`totalmem()`和`freemem()`这两个方法用于查看操作系统的内存使用情况，它们分别返回系统的总内存和闲置内存，以字节为单位。示例代码如下：

```ts
$ node 
> os.totalmem() 
8589934592 
> os.freemem() 
4527833088 
```

从输出信息可以看到我的电脑的总内存为`8 GB`，当前闲置内存大致为`4.2 GB`。

### 堆外内存

通过`process.memoryUsage()`的结果可以看到，堆中的内存用量总是小于进程的常驻内存用量，这意味着`Node`中的内存使用并非都是通过`V8`进行分配的。我们将那些不是通过`V8`分配的内存称为堆外内存。

