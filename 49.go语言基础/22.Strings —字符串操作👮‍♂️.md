# Strings å­—ç¬¦ä¸²æ“ä½œğŸ‘®â€â™‚ï¸

### stringsåŒ…çš„Readeræ¥å£

è§£è¯»ä¹‹å‰å…ˆæ¥ç†è§£ä¸€ä¸‹readeræ¥å£å’Œwriteræ¥å£ï¼Œæƒ³è±¡ä¸€ä¸‹è¯»å’Œå†™çš„è¿‡ç¨‹ã€‚

```go
type Reader interface {
	Read(p []byte) (n int, err error)
}
```

> å¯ä»¥çœ‹åˆ°è¿™ä¸ª**Read**å‡½æ•°æ¥å—ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ª**int n**å’Œ**err**ï¼Œ**int n**è¿”å›çš„æ—¶è¯»å–å­—èŠ‚æ•°ï¼Œ**err**è¿”å›çš„ä¸€èˆ¬æ˜¯**EOFï¼ˆEND-OF-FILEï¼‰**æˆ–è€…æ˜¯**NIL**ï¼Œå½“æˆ‘ä»¬æ²¡å®Œå…¨è¯»å®Œæ–‡ä»¶æ—¶è¿”å›çš„å°±æ˜¯**NIL**ï¼Œå¦åˆ™å°±æ˜¯**EOF**ã€‚è¯»å‡ºæ¥çš„å­—ç¬¦ä¼šç›´æ¥è¯»åˆ°å­—èŠ‚æ•°ç»„**p**ä¸­ï¼Œå› ä¸ºæ˜¯åˆ‡ç‰‡æ•°ç»„æ‰€ä»¥ä¼šå¯¹åŸæ•°ç»„å†…å®¹é€ æˆå½±å“ï¼Œä¸éœ€è¦è¿”å›å¹¶ä¸”æ¥å—ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼Œå…¶åŠŸèƒ½å¤§æ¦‚æ˜¯å¯¹æ•°ç»„è¿›è¡Œè¾“å…¥ï¼Œå¹¶ä¸”æ ¹æ®nåˆ¤æ–­æ˜¯å¦è¯»åˆ°äº†å€¼è¿”å›å­—èŠ‚æ•°ç»„ã€‚

```go
func ReadFrom(reader io.Reader, num int) ([]byte, error) {
	p := make([]byte, num)
	n, err := reader.Read(p)
	fmt.Println(n)
	if n > 0 {
		return p[:n], nil
	}
	return p, err
}
```

æˆ‘ä»¬è°ƒç”¨stringsä¸‹çš„NewReaderæ–¹æ³•è¿”å›ä¸€ä¸ªç¬¦åˆio.Readerçš„ç»“æ„ä½“ï¼Œç„¶åæˆ‘ä»¬å¯¹å…¶è¿›è¡Œä¸‰æ¬¡è¯»å–ã€‚

```go
func main(){
	s := strings.NewReader("123")
	data1, err := ReadFrom(s,1)
	data2, err := ReadFrom(s,2)
	data3, err := ReadFrom(s,3)
	fmt.Println(data1,err)
	fmt.Println(data2,err)
	fmt.Println(data3,err)
}
```

åˆ†æè¯»å–ç»“æœï¼Œæˆ‘ä»¬å‘ç°è¯»å–æ˜¯è®°å½•çŠ¶æ€çš„ï¼Œè¯»ä¸åˆ°ä¸œè¥¿çš„æ—¶å€™è¿”å›äº†endOfFileã€‚

```go
1 <nil>
2 <nil>
0 EOF
[49] EOF
[50 51] EOF
[0 0 0] EOF
```

é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹**strings.NewReader("123")**è¿”å›äº†æ€ä¹ˆæ ·çš„ä¸€ä¸ªå®ç°è€…ã€‚

```go
func NewReader(s string) *Reader { return &Reader{s, 0, -1} }
type Reader struct {
	s        string
	i        int64 // current reading index
	prevRune int   // index of previous rune; or < 0
}
```

> è¿™é‡Œé¢string sè®°å½•å®é™…çš„å†…å®¹ï¼Œiè¡¨ç¤ºå·²ç»è¯»åˆ°çš„ä½ç½®ï¼ŒprevRuneè¡¨ç¤ºä¸Šä¸€ä¸ªã€‚

##### Read

æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ä»–çš„readæ–¹æ³•

```go
func (r *Reader) Read(b []byte) (n int, err error) {
	if r.i >= int64(len(r.s)) {
		return 0, io.EOF
	}
	r.prevRune = -1
	n = copy(b, r.s[r.i:])
	r.i += int64(n)
	return
}
```

> å¦‚æœè¯´**r.i >= int64(len(r.s)ï¼‰**é‚£ä¹ˆå­—ç¬¦ä¸²å·²ç»è¢«è¯»å®Œäº†ï¼Œè¿”å›**EOF**ï¼Œå¦åˆ™æ‹·è´å­—ç¬¦ä¸²å†…å®¹åˆ°btyeæ•°ç»„ä¸­ï¼Œç„¶ååç§»r.iæ‹·è´æ•°ç»„çš„é•¿åº¦ï¼Œè¿”å›å®é™…è¯»å–å­—ç¬¦ä¸²çš„é•¿åº¦å’Œnilï¼ˆæ²¡æœ‰è¯»å–é”™è¯¯ï¼‰ã€‚è¿™å°±æ˜¯ä¸€ä¸ªreadçš„è¿‡ç¨‹ã€‚

##### ReadAt

ç„¶åå†çœ‹çœ‹ReadAtæ–¹æ³•

```go
func (r *Reader) ReadAt(b []byte, off int64) (n int, err error) {
	if off < 0 {
		return 0, errors.New("strings.Reader.ReadAt: negative offset")
	}
	if off >= int64(len(r.s)) {
		return 0, io.EOF
	}
	n = copy(b, r.s[off:])
	if n < len(b) {
		err = io.EOF
	}
	return
}
```

> å…ˆåˆ¤æ–­åç§»é‡æ˜¯å¦è¶Šç•Œï¼Œç„¶åæ‹·è´æ•°ç»„ï¼Œå¦‚æœæ‹·è´æ²¡æœ‰å®é™…æ‹·è´æ•ˆæœå°±æŠ›å‡ºEOFï¼Œå¦åˆ™è¿”å›æ‹·è´å­—èŠ‚æ•°å’Œnullï¼Œè¿™ä¸ªå°±ä¸éœ€è¦è€ƒè™‘ä¸Šä¸€æ¬¡çš„è¯»å–ä½ç½®äº†ï¼Œæ¯ä¸€æ¬¡éƒ½æ˜¯éšæœºçš„ã€‚

