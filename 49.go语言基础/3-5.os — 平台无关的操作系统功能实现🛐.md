# os â€” å¹³å°æ— å…³çš„æ“ä½œç³»ç»ŸåŠŸèƒ½å®ç°ğŸ›

`os` åŒ…æä¾›äº†å¹³å°æ— å…³çš„æ“ä½œç³»ç»ŸåŠŸèƒ½æ¥å£ã€‚å°½ç®¡é”™è¯¯å¤„ç†æ˜¯ go é£æ ¼çš„ï¼Œä½†è®¾è®¡æ˜¯ Unix é£æ ¼çš„ï¼›æ‰€ä»¥ï¼Œå¤±è´¥çš„è°ƒç”¨ä¼šè¿”å› `error` è€Œéé”™è¯¯ç ã€‚é€šå¸¸ `error` é‡Œä¼šåŒ…å«æ›´å¤šä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶åçš„è°ƒç”¨ï¼ˆå¦‚ Openã€Statï¼‰å¤±è´¥äº†ï¼Œæ‰“å°é”™è¯¯æ—¶ä¼šåŒ…å«è¯¥æ–‡ä»¶åï¼Œé”™è¯¯ç±»å‹å°†ä¸º `*PathError`ï¼Œå…¶å†…éƒ¨å¯ä»¥è§£åŒ…è·å¾—æ›´å¤šä¿¡æ¯ã€‚

os åŒ…è§„å®šä¸ºæ‰€æœ‰æ“ä½œç³»ç»Ÿå®ç°çš„æ¥å£éƒ½æ˜¯ä¸€è‡´çš„ã€‚æœ‰ä¸€äº›æŸä¸ªç³»ç»Ÿç‰¹å®šçš„åŠŸèƒ½ï¼Œéœ€è¦ä½¿ç”¨ `syscall` è·å–ã€‚å®é™…ä¸Šï¼Œ`os` ä¾èµ–äº `syscall`ã€‚åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥æ€»æ˜¯ä¼˜å…ˆä½¿ç”¨ `os` ä¸­æä¾›çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ `syscall`ã€‚

## æ–‡ä»¶ I/Oâ™“

åœ¨ç¬¬ä¸€ç« ï¼Œæˆ‘ä»¬è¾ƒå…¨é¢çš„ä»‹ç»äº† Go ä¸­çš„ I/Oã€‚æœ¬èŠ‚ï¼Œæˆ‘ä»¬ç€é‡ä»‹ç»æ–‡ä»¶ç›¸å…³çš„ I/Oã€‚å› ä¸º I/O æ“ä½œæ¶‰åŠåˆ°ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨è®²è§£æ—¶ä¼šæ¶‰åŠåˆ° Unix åœ¨è¿™æ–¹é¢çš„ç³»ç»Ÿè°ƒç”¨ã€‚

åœ¨ Unix ç³»ç»Ÿè°ƒç”¨ä¸­ï¼Œæ‰€æœ‰ I/O æ“ä½œä»¥æ–‡ä»¶æè¿°ç¬¦ ( ä¸€ä¸ªéè´Ÿæ•´æ•° , é€šå¸¸æ˜¯å°æ•´æ•° ) æ¥æŒ‡ä»£æ‰“å¼€çš„æ–‡ä»¶ã€‚æ–‡ä»¶æè¿°ç¬¦ç”¨ä»¥è¡¨ç¤ºæ‰€æœ‰ç±»å‹çš„å·²æ‰“å¼€æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç®¡é“ï¼ˆpipeï¼‰ã€FIFOã€socketã€ç»ˆç«¯ã€è®¾å¤‡å’Œæ™®é€šæ–‡ä»¶ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¸»è¦ä»‹ç»æ™®é€šæ–‡ä»¶çš„ I/Oã€‚

åœ¨ Go ä¸­ï¼Œæ–‡ä»¶æè¿°ç¬¦å°è£…åœ¨ `os.File` ç»“æ„ä¸­ï¼Œé€šè¿‡ `File.Fd()` å¯ä»¥è·å¾—åº•å±‚çš„æ–‡ä»¶æè¿°ç¬¦ï¼šfdã€‚

æŒ‰ç…§æƒ¯ä¾‹ï¼Œå¤§å¤šæ•°ç¨‹åºéƒ½æœŸæœ›èƒ½å¤Ÿä½¿ç”¨ 3 ç§æ ‡å‡†çš„æ–‡ä»¶æè¿°ç¬¦ï¼š0- æ ‡å‡†è¾“å…¥ï¼›1- æ ‡å‡†è¾“å‡ºï¼›2- æ ‡å‡†é”™è¯¯ã€‚`os` åŒ…æä¾›äº† 3 ä¸ª `File` å¯¹è±¡ï¼Œåˆ†åˆ«ä»£è¡¨è¿™ 3 ç§æ ‡å‡†æè¿°ç¬¦ï¼š`Stdin`ã€`Stdout` å’Œ `Stderr`ï¼Œå®ƒä»¬å¯¹åº”çš„æ–‡ä»¶ååˆ†åˆ«æ˜¯ï¼š/dev/stdinã€/dev/stdout å’Œ /dev/stderrã€‚æ³¨æ„ï¼Œè¿™é‡Œè¯´çš„æ–‡ä»¶åï¼Œå¹¶ä¸ä¸€å®šå­˜åœ¨ï¼Œæ¯”å¦‚ Windows ä¸‹å°±æ²¡æœ‰ã€‚

## æ ‡å‡†è¾“å…¥ã€è¾“å‡ºã€é”™è¯¯ğŸ†”

**stdout**, **stdin**, **stderr**çš„ä¸­æ–‡åå­—åˆ†åˆ«æ˜¯æ ‡å‡†è¾“å‡ºï¼Œæ ‡å‡†è¾“å…¥å’Œæ ‡å‡†é”™è¯¯ã€‚åœ¨Linuxä¸‹ï¼Œå½“ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºè¯¥è¿›ç¨‹åˆ›å»ºä¸‰ä¸ªæ•°æ®æµï¼Œä¹Ÿå°±æ˜¯é¢˜ç›®ä¸­æ‰€æåˆ°çš„è¿™ä¸‰ä¸ªã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯æ•°æ®æµå‘¢ï¼ˆstreamï¼‰ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªç¨‹åºè¦è¿è¡Œï¼Œéœ€è¦æœ‰è¾“å…¥ã€è¾“å‡ºï¼Œå¦‚æœå‡ºé”™ï¼Œè¿˜è¦èƒ½è¡¨ç°å‡ºè‡ªèº«çš„é”™è¯¯ã€‚è¿™æ˜¯å°±è¦ä»æŸä¸ªåœ°æ–¹è¯»å…¥æ•°æ®ã€å°†æ•°æ®è¾“å‡ºåˆ°æŸä¸ªåœ°æ–¹ï¼Œè¿™å°±å¤Ÿæˆäº†æ•°æ®æµã€‚

å› æ­¤ï¼Œä¸€ä¸ªè¿›ç¨‹åˆæœŸæ‰€æ‹¥æœ‰çš„è¿™ä¹ˆä¸‰ä¸ªæ•°æ®æµï¼Œå°±åˆ†åˆ«æ˜¯æ ‡å‡†è¾“å‡ºã€æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†é”™è¯¯ï¼Œåˆ†åˆ«ç”¨stdout, stdin, stderræ¥è¡¨ç¤ºã€‚å¯¹äºè¿™ä¸‰ä¸ªæ•°æ®æµæ¥è¯´ï¼Œé»˜è®¤æ˜¯è¡¨ç°åœ¨ç”¨æˆ·ç»ˆç«¯ä¸Šçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨goä¸­ä½¿ç”¨fmt.Fprintf:

```go
package main
import (
	"fmt"
	"os"
)

func main() {
	fmt.Fprint(os.Stdout,"åƒé¥­çœŸç›¸")
}
//åƒé¥­çœŸç›¸
```

æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯é»˜è®¤éƒ½æ˜¯å°†ä¿¡æ¯è¾“å‡ºåˆ°ç»ˆç«¯ä¸Šï¼Œé‚£ä¹ˆä»–ä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹ä¸ªé¢˜ç›®ï¼š

**é—®é¢˜ï¼šä¸‹é¢ç¨‹åºçš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆintelç¬”è¯•2011ï¼‰**

```c
int main(){
	fprintf(stdout,"Hello ");
	fprintf(stderr,"World!");
	return0;
}
```

è§£ç­”ï¼šè¿™æ®µä»£ç çš„è¾“å‡ºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä½ å¯ä»¥å¿«é€Ÿçš„å°†ä»£ç æ•²å…¥ä½ ç”µè„‘ä¸Šï¼ˆå½“ç„¶ï¼Œæ‹·è´æ›´å¿«ï¼‰ï¼Œç„¶åå‘ç°è¾“å‡ºæ˜¯

```
World!Hello
```

è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œstdoutæ˜¯è¡Œç¼“å†²çš„ï¼Œä»–çš„è¾“å‡ºä¼šæ”¾åœ¨ä¸€ä¸ªbufferé‡Œé¢ï¼Œåªæœ‰åˆ°æ¢è¡Œçš„æ—¶å€™ï¼Œæ‰ä¼šè¾“å‡ºåˆ°å±å¹•ã€‚è€Œstderræ˜¯æ— ç¼“å†²çš„ï¼Œä¼šç›´æ¥è¾“å‡ºï¼Œä¸¾ä¾‹æ¥è¯´å°±æ˜¯printf(stdout, "xxxx") å’Œ printf(stdout, "xxxx\n")ï¼Œå‰è€…ä¼šæ†‹ä½ï¼Œç›´åˆ°é‡åˆ°æ–°è¡Œæ‰ä¼šä¸€èµ·è¾“å‡ºã€‚è€Œprintf(stderr, "xxxxx")ï¼Œä¸ç®¡æœ‰ä¹ˆæœ‰\nï¼Œéƒ½è¾“å‡ºã€‚



## æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼šOpenã€Createã€ReadFileâ™‰

### OPENã€CREATE

æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸€èˆ¬é€šè¿‡ `Open` æˆ– `Create`ï¼Œæˆ‘ä»¬çœ‹è¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°ã€‚

> è¯»å–æ—¶ä¸€èˆ¬ä½¿ç”¨openï¼Œå†™å…¥æ—¶ä¸€èˆ¬ä½¿ç”¨createï¼Œä¸ç„¶å†™å…¥æ—¶å°±ä¼šæŠ¥**C:\GOPKG\src\go_learning\src\eorrorhandle\test.txt: Access is denied.**çš„é”™è¯¯

```go
func Open(name string) (*File, error) {
    return OpenFile(name, O_RDONLY, 0)
}

func Create(name string) (*File, error) {
    return OpenFile(name, O_RDWR|O_CREATE|O_TRUNC, 0666)
}
```

### OpenFIle

`OpenFile` æ—¢èƒ½æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶ï¼Œä¹Ÿèƒ½åˆ›å»ºå¹¶æ‰“å¼€ä¸€ä¸ªæ–°æ–‡ä»¶ã€‚

```go
func OpenFile(name string, flag int, perm FileMode) (*File, error)
```

`OpenFile` æ˜¯ä¸€ä¸ªæ›´ä¸€èˆ¬æ€§çš„æ–‡ä»¶æ‰“å¼€å‡½æ•°ï¼Œå¤§å¤šæ•°è°ƒç”¨è€…éƒ½åº”ç”¨ `Open` æˆ– `Create` ä»£æ›¿æœ¬å‡½æ•°ã€‚å®ƒä¼šä½¿ç”¨æŒ‡å®šçš„é€‰é¡¹ï¼ˆå¦‚ O_RDONLY ç­‰ï¼‰ã€æŒ‡å®šçš„æ¨¡å¼ï¼ˆå¦‚ 0666 ç­‰ï¼‰æ‰“å¼€æŒ‡å®šåç§°çš„æ–‡ä»¶ã€‚å¦‚æœæ“ä½œæˆåŠŸï¼Œè¿”å›çš„æ–‡ä»¶å¯¹è±¡å¯ç”¨äº I/Oã€‚å¦‚æœå‡ºé”™ï¼Œé”™è¯¯åº•å±‚ç±»å‹æ˜¯ `*PathError`ã€‚

è¦æ‰“å¼€çš„æ–‡ä»¶ç”±å‚æ•° `name` æŒ‡å®šï¼Œå®ƒå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹äºè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ˆä¼šå¯¹å…¶è¿›è¡Œè§£å¼•ç”¨ï¼‰ã€‚

**ä½æ©ç å‚æ•° `flag`** ç”¨äºæŒ‡å®šæ–‡ä»¶çš„è®¿é—®æ¨¡å¼ï¼Œå¯ç”¨çš„å€¼åœ¨ `os` ä¸­å®šä¹‰ä¸ºå¸¸é‡ï¼ˆä»¥ä¸‹å€¼å¹¶éæ‰€æœ‰æ“ä½œç³»ç»Ÿéƒ½å¯ç”¨ï¼‰ï¼š

```
const (
    O_RDONLY int = syscall.O_RDONLY // åªè¯»æ¨¡å¼æ‰“å¼€æ–‡ä»¶
    O_WRONLY int = syscall.O_WRONLY // åªå†™æ¨¡å¼æ‰“å¼€æ–‡ä»¶
    O_RDWR   int = syscall.O_RDWR   // è¯»å†™æ¨¡å¼æ‰“å¼€æ–‡ä»¶
    O_APPEND int = syscall.O_APPEND // å†™æ“ä½œæ—¶å°†æ•°æ®é™„åŠ åˆ°æ–‡ä»¶å°¾éƒ¨
    O_CREATE int = syscall.O_CREAT  // å¦‚æœä¸å­˜åœ¨å°†åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶
    O_EXCL   int = syscall.O_EXCL   // å’Œ O_CREATE é…åˆä½¿ç”¨ï¼Œæ–‡ä»¶å¿…é¡»ä¸å­˜åœ¨
    O_SYNC   int = syscall.O_SYNC   // æ‰“å¼€æ–‡ä»¶ç”¨äºåŒæ­¥ I/O
    O_TRUNC  int = syscall.O_TRUNC  // å¦‚æœå¯èƒ½ï¼Œæ‰“å¼€æ—¶æ¸…ç©ºæ–‡ä»¶
)
```

å…¶ä¸­ï¼Œ`O_RDONLY`ã€`O_WRONLY`ã€`O_RDWR` åº”è¯¥åªæŒ‡å®šä¸€ä¸ªï¼Œå‰©ä¸‹çš„é€šè¿‡ `|` æ“ä½œç¬¦æ¥æŒ‡å®šã€‚è¯¥å‡½æ•°å†…éƒ¨ä¼šç»™ `flags` åŠ ä¸Š `syscall.O_CLOEXEC`ï¼Œåœ¨ fork å­è¿›ç¨‹æ—¶ä¼šå…³é—­é€šè¿‡ `OpenFile` æ‰“å¼€çš„æ–‡ä»¶ï¼Œå³å­è¿›ç¨‹ä¸ä¼šé‡ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦ã€‚

*æ³¨æ„ï¼šç”±äºå†å²åŸå› ï¼ŒO_RDONLY | O_WRONLY å¹¶éç­‰äº O_RDWRï¼Œå®ƒä»¬çš„å€¼ä¸€èˆ¬æ˜¯ 0ã€1ã€2ã€‚*

**ä½æ©ç å‚æ•° `perm`** æŒ‡å®šäº†æ–‡ä»¶çš„æ¨¡å¼å’Œæƒé™ä½ï¼Œç±»å‹æ˜¯ `os.FileMode`ï¼Œæ–‡ä»¶æ¨¡å¼ä½å¸¸é‡å®šä¹‰åœ¨ `os` ä¸­ï¼š

```go
const (
    // å•å­—ç¬¦æ˜¯è¢« String æ–¹æ³•ç”¨äºæ ¼å¼åŒ–çš„å±æ€§ç¼©å†™ã€‚
    ModeDir        FileMode = 1 << (32 - 1 - iota) // d: ç›®å½•
    ModeAppend                                     // a: åªèƒ½å†™å…¥ï¼Œä¸”åªèƒ½å†™å…¥åˆ°æœ«å°¾
    ModeExclusive                                  // l: ç”¨äºæ‰§è¡Œ
    ModeTemporary                                  // T: ä¸´æ—¶æ–‡ä»¶ï¼ˆéå¤‡ä»½æ–‡ä»¶ï¼‰
    ModeSymlink                                    // L: ç¬¦å·é“¾æ¥ï¼ˆä¸æ˜¯å¿«æ·æ–¹å¼æ–‡ä»¶ï¼‰
    ModeDevice                                     // D: è®¾å¤‡
    ModeNamedPipe                                  // p: å‘½åç®¡é“ï¼ˆFIFOï¼‰
    ModeSocket                                     // S: Unix åŸŸ socket
    ModeSetuid                                     // u: è¡¨ç¤ºæ–‡ä»¶å…·æœ‰å…¶åˆ›å»ºè€…ç”¨æˆ· id æƒé™
    ModeSetgid                                     // g: è¡¨ç¤ºæ–‡ä»¶å…·æœ‰å…¶åˆ›å»ºè€…ç»„ id çš„æƒé™
    ModeCharDevice                                 // c: å­—ç¬¦è®¾å¤‡ï¼Œéœ€å·²è®¾ç½® ModeDevice
    ModeSticky                                     // t: åªæœ‰ root/ åˆ›å»ºè€…èƒ½åˆ é™¤ / ç§»åŠ¨æ–‡ä»¶

    // è¦†ç›–æ‰€æœ‰ç±»å‹ä½ï¼ˆç”¨äºé€šè¿‡ & è·å–ç±»å‹ä½ï¼‰ï¼Œå¯¹æ™®é€šæ–‡ä»¶ï¼Œæ‰€æœ‰è¿™äº›ä½éƒ½ä¸åº”è¢«è®¾ç½®
    ModeType = ModeDir | ModeSymlink | ModeNamedPipe | ModeSocket | ModeDevice
    ModePerm FileMode = 0777 // è¦†ç›–æ‰€æœ‰ Unix æƒé™ä½ï¼ˆç”¨äºé€šè¿‡ & è·å–ç±»å‹ä½ï¼‰
)
```

ä»¥ä¸Šå¸¸é‡åœ¨æ‰€æœ‰æ“ä½œç³»ç»Ÿéƒ½æœ‰ç›¸åŒçš„å«ä¹‰ï¼ˆå¯ç”¨æ—¶ï¼‰ï¼Œå› æ­¤æ–‡ä»¶çš„ä¿¡æ¯å¯ä»¥åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¹‹é—´å®‰å…¨çš„ç§»æ¤ã€‚ä¸æ˜¯æ‰€æœ‰çš„ä½éƒ½èƒ½ç”¨äºæ‰€æœ‰çš„ç³»ç»Ÿï¼Œå”¯ä¸€å…±æœ‰çš„æ˜¯ç”¨äºè¡¨ç¤ºç›®å½•çš„ `ModeDir` ä½ã€‚

ä»¥ä¸Šè¿™äº›è¢«å®šä¹‰çš„ä½æ˜¯ `FileMode` æœ€é‡è¦çš„ä½ã€‚å¦å¤– 9 ä¸ªä½ï¼ˆæƒé™ä½ï¼‰ä¸ºæ ‡å‡† Unix rwxrwxrwx æƒé™ï¼ˆæ‰€æœ‰äººéƒ½å¯è¯»ã€å†™ã€è¿è¡Œï¼‰ã€‚

`FileMode` è¿˜å®šä¹‰äº†å‡ ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­æ–‡ä»¶ç±»å‹çš„ `IsDir()` å’Œ `IsRegular()`ï¼Œç”¨äºè·å–æƒé™çš„ `Perm()`ã€‚

è¿”å›çš„ `error`ï¼Œå…·ä½“å®ç°æ˜¯ `*os.PathError`ï¼Œå®ƒä¼šè®°å½•å…·ä½“æ“ä½œã€æ–‡ä»¶è·¯å¾„å’Œé”™è¯¯åŸå› ã€‚

**å¦å¤–ï¼Œåœ¨ `OpenFile` å†…éƒ¨ä¼šè°ƒç”¨ `NewFile`ï¼Œæ¥å¾—åˆ° `File` å¯¹è±¡ï¼ŒåŒæ—¶Fileå¯¹è±¡å®ç°äº†io.Writerå’Œio.Reader**



### å…³é—­æ–‡ä»¶ï¼šClose

`close()` ç³»ç»Ÿè°ƒç”¨å…³é—­ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶å°†å…¶é‡Šæ”¾å›è°ƒç”¨è¿›ç¨‹ï¼Œä¾›è¯¥è¿›ç¨‹ç»§ç»­ä½¿ç”¨ã€‚å½“è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå°†è‡ªåŠ¨å…³é—­å…¶å·²æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦ã€‚

```go
func (f *File) Close() error
```

`os.File.Close()` æ˜¯å¯¹ `close()` çš„å°è£…ã€‚æˆ‘ä»¬åº”è¯¥å…»æˆå…³é—­ä¸éœ€è¦çš„æ–‡ä»¶çš„è‰¯å¥½ç¼–ç¨‹ä¹ æƒ¯ã€‚æ–‡ä»¶æè¿°ç¬¦æ˜¯èµ„æºï¼ŒGo çš„ gc æ˜¯é’ˆå¯¹å†…å­˜çš„ï¼Œå¹¶ä¸ä¼šè‡ªåŠ¨å›æ”¶èµ„æºï¼Œå¦‚æœä¸å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œé•¿æœŸè¿è¡Œçš„æœåŠ¡å¯èƒ½ä¼šæŠŠæ–‡ä»¶æè¿°ç¬¦è€—å°½ã€‚

æ‰€ä»¥ï¼Œé€šå¸¸çš„å†™æ³•å¦‚ä¸‹ï¼š

```go
file, err := os.Open("/tmp/studygolang.txt")
if err != nil {
    // é”™è¯¯å¤„ç†ï¼Œä¸€èˆ¬ä¼šé˜»æ­¢ç¨‹åºå¾€ä¸‹æ‰§è¡Œ
    return
}
defer file.Close()
```

**å…³äºè¿”å›å€¼ error**

ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¼šå¯¼è‡´ `Close` è¿”å›é”™è¯¯ï¼š

```
1. å…³é—­ä¸€ä¸ªæœªæ‰“å¼€çš„æ–‡ä»¶ï¼›
2. ä¸¤æ¬¡å…³é—­åŒä¸€ä¸ªæ–‡ä»¶ï¼›
```

é€šå¸¸ï¼Œæˆ‘ä»¬ä¸ä¼šå»æ£€æŸ¥ `Close` çš„é”™è¯¯ã€‚



## è¯»å–æ–‡ä»¶å†…å®¹ï¼šReadã€ReadAtğŸˆ³

### Read

```go
func (f *File) Read(b []byte) (n int, err error)
```

`Read` æ–¹æ³•ä» `f` ä¸­è¯»å–æœ€å¤š `len(b)` å­—èŠ‚æ•°æ®å¹¶å†™å…¥ `b`ã€‚å®ƒè¿”å›è¯»å–çš„å­—èŠ‚æ•°å’Œå¯èƒ½é‡åˆ°çš„ä»»ä½•é”™è¯¯ã€‚æ–‡ä»¶ç»ˆæ­¢æ ‡å¿—æ˜¯è¯»å– 0 ä¸ªå­—èŠ‚ä¸”è¿”å›å€¼ err ä¸º `io.EOF`ã€‚

```go
func openIt(filename string){
   f,err := os.Open(filename)
   defer f.Close()
   if err != nil {
      panic(err)
   }
   b := make([]byte,10)
   f.Read(b)
   n,err := f.Read(b)
   fmt.Println(n,err)
   fmt.Println(fmt.Sprintf("%s",b))
}
```

### ReadAt

```go
func (f *File) ReadAt(b []byte, off int64) (n int, err error)
```

`ReadAt` ä»æŒ‡å®šçš„ä½ç½®ï¼ˆç›¸å¯¹äºæ–‡ä»¶å¼€å§‹ä½ç½®ï¼‰è¯»å–é•¿åº¦ä¸º `len(b)` ä¸ªå­—èŠ‚æ•°æ®å¹¶å†™å…¥ `b`ã€‚å®ƒè¿”å›è¯»å–çš„å­—èŠ‚æ•°å’Œå¯èƒ½é‡åˆ°çš„ä»»ä½•é”™è¯¯ã€‚å½“ n<len(b) æ—¶ï¼Œæœ¬æ–¹æ³•æ€»æ˜¯ä¼šè¿”å›é”™è¯¯ï¼›å¦‚æœæ˜¯å› ä¸ºåˆ°è¾¾æ–‡ä»¶ç»“å°¾ï¼Œè¿”å›å€¼ err ä¼šæ˜¯ `io.EOF`ã€‚å®ƒå¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨æ˜¯ `pread`ã€‚

```go
func openItAt(filename string,off int64){
   f,err := os.Open(filename)
   defer f.Close()
   if err != nil {
      panic(err)
   }
   b := make([]byte,10)
   f.ReadAt(b,off)
   fmt.Println(fmt.Sprintf("%s",b))
}
```

> **Read å’Œ ReadAt çš„åŒºåˆ«**ï¼šå‰è€…ä»æ–‡ä»¶å½“å‰åç§»é‡å¤„è¯»ï¼Œä¸”ä¼šæ”¹å˜æ–‡ä»¶å½“å‰çš„åç§»é‡ï¼›è€Œåè€…ä» `off` æŒ‡å®šçš„ä½ç½®å¼€å§‹è¯»ï¼Œä¸”**ä¸ä¼šæ”¹å˜**æ–‡ä»¶å½“å‰åç§»é‡ã€‚



## æ•°æ®å†™å…¥æ–‡ä»¶ï¼šWriteã€WriteAtâ™

### Write

```go
func (f *File) Write(b []byte) (n int, err error)
```

`Write` å‘æ–‡ä»¶ä¸­å†™å…¥ `len(b)` å­—èŠ‚æ•°æ®ã€‚å®ƒè¿”å›å†™å…¥çš„å­—èŠ‚æ•°å’Œå¯èƒ½é‡åˆ°çš„ä»»ä½•é”™è¯¯ã€‚å¦‚æœè¿”å›å€¼ `n!=len(b)`ï¼Œæœ¬æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªé nil çš„é”™è¯¯ã€‚

ä»æ–¹æ³•å£°æ˜å¯ä»¥çŸ¥é“ï¼Œ`File` å®ç°äº† `io.Writer` æ¥å£ã€‚

`Write` å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨æ˜¯ `write`ã€‚

```go
func writeIt(b []byte,filename string){
   f,err := os.Create(filename)
   defer f.Close()
   if err != nil {
      panic(err)
   }
   n,err := f.Write(b)
   fmt.Println(n,err)
}
```

### WriteAt

`Write` ä¸ `WriteAt` çš„åŒºåˆ«åŒ `Read` ä¸ `ReadAt` çš„åŒºåˆ«ä¸€æ ·ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œè¿˜æä¾›äº† `WriteString` æ–¹æ³•ï¼Œå®ƒå®é™…æ˜¯å¯¹ `Write` çš„å°è£…ã€‚

```go
func (f *File) Write(b []byteï¼Œoff int64) (n int, err error)
```



> **æ³¨æ„**ï¼š`Write` è°ƒç”¨æˆåŠŸå¹¶ä¸èƒ½ä¿è¯æ•°æ®å·²ç»å†™å…¥ç£ç›˜ï¼Œå› ä¸ºå†…æ ¸ä¼šç¼“å­˜ç£ç›˜çš„ I/O æ“ä½œã€‚å¦‚æœå¸Œæœ›ç«‹åˆ»å°†æ•°æ®å†™å…¥ç£ç›˜ï¼ˆä¸€èˆ¬åœºæ™¯ä¸å»ºè®®è¿™ä¹ˆåšï¼Œå› ä¸ºä¼šå½±å“æ€§èƒ½ï¼‰ï¼Œæœ‰ä¸¤ç§åŠæ³•ï¼š
>
> ```go
> 1. æ‰“å¼€æ–‡ä»¶æ—¶æŒ‡å®š `os.O_SYNC`ï¼›
> 2. è°ƒç”¨ `File.Sync()` æ–¹æ³•ã€‚
> ```



## å¾ªç¯è¯»å–æ–‡ä»¶å†…å®¹ğŸ¯

ä½¿ç”¨forå¾ªç¯è¯»å–æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚

```go
func main() {
	// åªè¯»æ–¹å¼æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„main.goæ–‡ä»¶
	file, err := os.Open("./main.go")
	if err != nil {
		fmt.Println("open file failed!, err:", err)
		return
	}
	defer file.Close()
	// å¾ªç¯è¯»å–æ–‡ä»¶
	var content []byte
	var tmp = make([]byte, 128)
	for {
		n, err := file.Read(tmp)
		if err == io.EOF {
			fmt.Println("æ–‡ä»¶è¯»å®Œäº†")
			break
		}
		if err != nil {
			fmt.Println("read file failed, err:", err)
			return
		}
		content = append(content, tmp[:n]...)
	}
	fmt.Println(string(content))
}
```



## bufioè¯»å–æ–‡ä»¶ğŸ£

bufioæ˜¯åœ¨fileçš„åŸºç¡€ä¸Šå°è£…äº†ä¸€å±‚APIï¼Œæ”¯æŒæ›´å¤šçš„åŠŸèƒ½ã€‚

```go
package main

import (
	"bufio"
	"fmt"
	"io"
	"os"
)

// bufioæŒ‰è¡Œè¯»å–ç¤ºä¾‹
func main() {
	file, err := os.Open("./main.go")
	if err != nil {
		fmt.Println("open file failed, err:", err)
		return
	}
	defer file.Close()
	reader := bufio.NewReader(file)
	for {
		line, err := reader.ReadString('\n') //æ³¨æ„æ˜¯å­—ç¬¦
		if err == io.EOF {
			fmt.Println("æ–‡ä»¶è¯»å®Œäº†")
			break
		}
		if err != nil {
			fmt.Println("read file failed, err:", err)
			return
		}
		fmt.Print(line)
	}
}
```